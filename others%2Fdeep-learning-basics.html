<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.22" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>others/deep-learning-basics: My Struggle — Life goes on...</title>
</head>
<body class="tc-body">

<section class="tc-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists " data-tags="" data-tiddler-title="others/deep-learning-basics"><div class="tc-tiddler-title"><div class="tc-titlebar"><span class="tc-tiddler-controls"><span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span></span><span><span class="tc-tiddler-title-icon" style="fill:;"></span><h2 class="tc-title">others/deep-learning-basics</h2></span></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal"><div class="tc-subtitle"><a class="tc-tiddlylink tc-tiddlylink-missing" href=".html"></a>26th July 2020</div></div><div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>

<div class="tc-tiddler-body tc-reveal"><hr><p>title: ML - Docker 配置机器学习环境<br>edit: 2017-12-06<br>layout: post<br>categories:</p><ul><li><p>Python<br>tags:</p></li><li><p>Python<br>description: 如何在本地配置机器学习环境，使用Docker</p></li></ul><hr><h1>Docker 配置机器学习环境</h1><h2>安装Docker</h2><h3>Installer</h3><p><a href="https://docs.docker.com/toolbox/toolbox_install_windows/" target="_blank">Install Docker Toolbox on Windows | Docker Documentation</a></p><p>如果是legacy windows 比如windows Home, 由于docker需要enable Hyper-V模块，但微软官方说：</p><blockquote><p>The Hyper-V role <strong>cannot</strong> be installed on Windows 10 Home.</p></blockquote><p>所以上面的installer不能用在legacy windows上，需下载 <a href="https://docs.docker.com/toolbox/toolbox_install_windows/" target="_blank">Install Docker Toolbox on Windows | Docker Documentation</a></p><h2>安装</h2><p>傻瓜式。</p><p>登录docker vm:</p><pre><code>docker-machine ssh default
</code></pre><h2>启动docker service(server)</h2><p>Windows, run &quot;Docker for Windows&quot; from start menu</p><p>Mac, run docker as you run other apps</p><h2>启动docker client</h2><p>打开一个命令行窗口，输入command &quot;docker&quot;，可以看到很多子命令</p><pre><code>docker
</code></pre><h3>docker commands</h3><p>显示当前运行的容器</p><pre><code>docker ps
</code></pre><p>显示全部容器</p><pre><code>docker ps -a
</code></pre><p>重新启动已退出的容器</p><pre><code>docker start -i &lt;container id的前几位数&gt;
-i: 运行命令行和程序交互
</code></pre><p>删除容器(be careful)</p><pre><code>docker rm &lt;container id的前几位数&gt;
</code></pre><h2>Docker Volume Mounting</h2><p>suppose you want to expose your local folder to the docker container, you can do a folder mapping as follows:</p><ol><li><p>Go to Docker Settings dialog, add your local folder to shared driver. (Non-Legacy Windows)</p></li><li><p>For Legacy Windows:</p><ul><li><p>go to <a class="tc-tiddlylink tc-tiddlylink-missing" href="VirtualBox.html">VirtualBox</a> Manager -&gt; Share Drive, add c:\Users</p></li><li><p>run command</p><pre><code>docker run -it -p 8888:8888 -v //c/Users/vivia/OneDrive/Projects/DeepLearning/test:/home/tensorflow tensorflow/tensorflow
</code></pre><p>Reference as below:</p></li></ul><blockquote><p>On Windows, you can not directly map Windows directory to your container. Because your containers are reside inside a <a class="tc-tiddlylink tc-tiddlylink-missing" href="VirtualBox.html">VirtualBox</a> VM. So your <code>docker -v</code> command actually maps the directory between the VM and the container.</p><p>So you have to do it in two steps:</p><ul><li><p>Map a Windows directory to the VM through <a class="tc-tiddlylink tc-tiddlylink-missing" href="VirtualBox.html">VirtualBox</a> manager</p></li><li><p>Map a directory in your container to the directory in your VM</p></li></ul><p>You better use the Kitematic UI to help you. It is much eaiser.</p></blockquote><p><a href="https://stackoverflow.com/questions/33966225/shared-folder-in-docker-with-windows-not-only-c-user-path" target="_blank">boot2docker - Shared folder in Docker. With Windows. Not only &quot;C/user/&quot; path - Stack Overflow</a></p><blockquote><blockquote><p>I know that Docker only shares the /c/User/folder, is that right?</p></blockquote><p>It does, and it is able to do so because the <a class="tc-tiddlylink tc-tiddlylink-missing" href="VirtualBox.html">VirtualBox</a> VM used for providing a Linux host for docker is sharing C:\Users.</p><p>For docker to see another folder, you would need to:</p><ul><li><p>use <code>VBoxmanage sharedfolder add &quot;VM name&quot; --name &quot;sharename&quot; --hostpath &quot;D:\Works&quot;</code></p></li><li><p>then mount <code>/D/Works</code> within a VM session, as mentioned in &quot;<a href="https://stackoverflow.com/a/33935328/6309" target="_blank">share windows folder (other than c/Users/) with docker container (using docker windows client)</a>&quot;, and <a href="https://github.com/boot2docker/boot2docker/blob/master/README.md#virtualbox-guest-additions" target="_blank">mentioned in boot2docker</a>:</p><pre><code>mount -t vboxsf -o uid=1000,gid=50 sharename /some/mount/location

</code></pre></li></ul><hr></blockquote></li></ol><h2>Docker Hub</h2><p><a href="https://hub.docker.com/" target="_blank">Docker Hub</a> 上查找你需要的别人开发好的repository</p><h3>Docker</h3><h2>配置机器学习环境</h2><h3>Tensorflow</h3><p>在docker hub上搜索tensorflow, 找到后，复制其运行命令到本地，运行之</p><pre><code> docker-machine ip default
docker run -it -p 8888:8888 -v x:\\vboxsvr\DeepLearning:/tensorflow tensorflow/tensorflow
</code></pre><ul><li><p>-t 参数：可在命令行与docker容器内的程序进行交互</p></li><li><p>-v: 将本地的目录映射到容器内</p></li><li><p>-p: 端口。第一个8888是docker容器运行的端口；第二个8888是容器内app运行的端口</p></li></ul><p>运行成功后，你便以该tensorflow Image 为模板构建了你自己的容器</p><h3>Jupyter Notebook</h3><p>打开浏览器，输入“http://localhost:8888&quot;. on Windows however I failed to access it, had to replace Localhost with the default_ip (run &quot;docker-machine ip default&quot; to get it): http://192.168.99.100:8888</p><ul><li><p>shift + enter to run codes in notebook</p></li><li><p>! ls /tensorflow: 输入感叹号+终端命令，可以直接运行终端命令</p><pre><code>!python test.py
!pip install jieba
</code></pre><p>​</p></li></ul><h3>Jieba and collections</h3><p>pip install jieba</p><pre><code>import jieba
from collections import Counter
words = open('/home/tensorflow/slqm.txt').read().strip()
data = Counter()
for s in jieba.cut(words):
    data[s.encode('utf-8')] += 1
print(data)
</code></pre><h3>N-Gram</h3><p>Google n-gram viewer</p><h2>使用Tensorflow</h2><p><a href="http://www.cnblogs.com/wangxiaocvpr/p/5902086.html" target="_blank">一文读懂tensorflow</a></p><p>开源项目: deep_recommend_system</p><h3>1. 准备训练数据</h3><p>建议TFRecrods格式。</p><h3>2. 定义命令行参数</h3><p>tensorflow.app.flags</p><pre><code># define parameters
flags = tf.app.flags
FLAGS = flags.FLAGS
flags.DEFINE_float(&quot;learning_rate&quot; 0.01, 'Initial learning rate')
flags.DEFINE_integer
flags.DEFINE_string
flags.DEFINE_float
</code></pre><h3>3. 定义神经网络模型</h3><p>简单：创建多个Variable即可</p><p>复杂：tf.variable_scope(), tf.get_variables()</p><pre><code># define the model
input_units = FEATURE_SIZE
hidden1_units = 10
hidden2_units = 10
output_units = LABEL_SIZE
def full_connect(inputs, weights_shape, biases_shape):
    with tf.device('/cpu:0'):
        weights = tf.get_variable(&quot;weights&quot;, weights_shape,     initializer=tf.random_normal_initializer())
        biases = tf.get_variable(&quot;biases&quot;, biases_shape,    initializer=tf.random_normal_initializer())
    return tf.matmul(inputs, weights) + biases
</code></pre><h3>4. 使用不同的优化算法(Optimizer)</h3><pre><code>print(&quot;Use the optimizer: {}&quot;.format(FLAGS.optimizer))
if FLAGS.optimizer == &quot;sgd&quot;:
    optimizer = tf.train.GradientDescentOptimizer(learning_rate)
</code></pre><h3>5. Online Learning vs Continuous Learning</h3><p>Online Learning: 支持在线数据不断优化模型</p><p>Continuous Learning: 训练即使被中断，也能继续上次的训练结果继续优化模型</p><pre><code> xxxxxxxxxx tf.train.Saver() # 保存成checkpoint,用于下一次优化
</code></pre><h3>6. 使用<a class="tc-tiddlylink tc-tiddlylink-missing" href="TensorBoard.html">TensorBoard</a>优化参数</h3><p><a class="tc-tiddlylink tc-tiddlylink-missing" href="TensorBoard.html">TensorBoard</a>: 图形化攻击</p><pre><code>tf.scalar_summary('loss', loss)
</code></pre><h3>7. 分布式Tensorflow应用</h3><pre><code>test.py --ps_hosts=&lt;IP addrs&gt; --worker_hosts=&lt;ip addrs&gt; --job_name=ps --task_index=0
test.py --ps_hosts=&lt;IP addrs&gt; --worker_hosts=&lt;ip addrs&gt; --job_name=worker --task_index=1
</code></pre><ul><li><p>ps: 整个训练集群的参数服务器</p><ul><li><p>保存模型的Variable</p></li></ul></li><li><p>worker: 计算模型梯度的节点(operator)，得到的梯度向量会交付给ps更新模型</p></li><li><p>task: 用task_index来区分worker的工作任务</p></li><li><p>device：具体的CPU/GPU,通常PS绑定到CPU，worker绑定到GPU</p></li><li><p>in-graph, between-graph:</p><ul><li><p>in-graph:  整个集群由一个client来构建graph，且由其提交graph到集群中。其他worker只负责处理梯度计算的任务</p></li><li><p>between-graph: 一个集群中多个worker可以构建graph，但由于worker运行的代码相同因此构建的graph也相同，并且参数都保存到相同的ps中保证训练同一个模型，这样多个worker都可以构建graph和读取训练数据，适合大数据场景</p></li></ul></li></ul><h3>8. Cloud Machine Learning</h3></div>



</div>

</p>
</section>
</body>
</html>
