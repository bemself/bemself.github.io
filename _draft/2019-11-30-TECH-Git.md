# remove commit history

## git reset

- permanently remove git history
git reset --hard 559768c4ae7c6cab72340ff05c0d84443d906bd3
git pu -f origin <branch_name>

- keep git history and create new commit log
git revert


# Git log
To get the last n commit hashes it may be useful to use: git log --pretty=oneline --abbrev-commit | head -n
## check log for particular file 

git log --oneline 4-binary/01-arraybuffer-binary-arrays/article.md
git log --date=format:"%Y-%m-%d %H:%M:%S" --pretty="cSHA:%h %nauthor:%cN <%cE> %ndate:%cd %ncNotes:%B" 4-binary/01-arraybuffer-binary-arrays/article.md

## get file commit history from Github api

本来想 git clone 下来本地 git log 查看，结果速度奇慢，只好先找 api 帮忙。

https://api.github.com/repos/javascript-tutorial/en.javascript.info/commits?path=4-binary/01-arraybuffer-binary-arrays/article.md

https://github.com/javascript-tutorial/en.javascript.info/commit/3ba28aa104dac75caf8d128f3913dd9f3fb52bf4

# Git Merge

## issue: you need to resolve current index 

https://appuals.com/how-to-fix-git-error-you-need-to-resolve-your-current-index-first/

revert a merge:
git reset -–merge
git revert HEAD


# Git Diff
- [git - How to see the changes between two commits without commits in-between? - Stack Overflow](https://stackoverflow.com/questions/1191282/how-to-see-the-changes-between-two-commits-without-commits-in-between)

git diff e6ed86c7 54984506   4-binary/01-arraybuffer-binary-arrays/article.md > diff.patch

older commit is before the new commit

# issues

## 

本地的文件有修改，但还没有 indexed, 用 `git checkout` 不灵：
```
> git checkout <another_branch_name>
error: The following untracked working tree files would be overwritten by checkout:
        1-js/03-code-quality/01-debugging-chrome/largeIcons.svg
Please move or remove them before you switch branches.
```

如果你不想保留这些文件，那就加 `-f` 参数：

```
git checkout -f <another_branch_name> 
```

同样，在 `git merge`的时候也遇到过这个错误，但`git merge`没有 `-f`参数，所以只能先 track 文件再 merge 了，像这样：

```
git add * 
git stash
git stash drop        // 如果不想保留这个 stash
```

在 [这个答案](https://stackoverflow.com/questions/17404316/the-following-untracked-working-tree-files-would-be-overwritten-by-merge-but-i)中提到还有一种情况，上述解决方法就不灵了，

> This doesn't work if the files are from submodules that were removed and then readded as normal files

那样的话，就要用到这个命令：(我没有实操过这个，仅做记录待验)

```
git fetch --all
git reset --hard origin/{{your branch name}}
```

## git merge conflict, using ours or theirs

```
CONFLICT (content): Merge conflict in article.md
Automatic merge failed; fix conflicts and then commit the result.
```
解决方法：

```
git checkout --ours article.md
or
git checkout --theirs article.md
```
## unable to delete 'remote_branch': remote ref does not exist

我的某个 PR merge 之后， 页面提示我说你的 这个 PR 的分支可以安全删除了，我就愉快的删除了。

结果我到本地 `git brach -a` 发现还在呀：

```
remotes/origin/pr-branch
```

那就再删一遍吧：

```
git pu origin --delete pr-branch
```

但是报错了，`error: unable to delete 'pr-branch': remote ref does not exist`

原因自然是远程那个分支已经被删除了，那现在我`git br -a`看到的其实是我本地保存的 远程分支，只要把这个删除就好了

那怎么删？

首先想到用 `git branch -d remotes/origin/pr-branch` 来删，结果说`error: branch `remotes/origin/pr-branch` 不存在，但如果我 ```cat .git/refs/remotes/origin/pr-branch``` 是没问题的，那是咋回事？没有想通，想是 git 哪个环节失灵了。

好在还有其他办法，在[git remove branch](GIT-remove-branch.html) 一文中提到过，分支就是个指针，在系统中以文件形式存在着，所以找到 `.git/refs/remotes/origin`下面的以分支命名的文件，删掉即可: ```rm -f .git/refs/remotes/origin/pr-branch```


# Reference

- https://stackoverflow.com/questions/2003505/how-do-i-delete-a-git-branch-locally-and-remotely

- https://stackoverflow.com/questions/14034718/include-only-specific-commits-in-a-pull-request

- https://stackoverflow.com/questions/34027850/how-to-pull-request-a-specific-commit

- https://stackoverflow.com/questions/1628563/move-the-most-recent-commits-to-a-new-branch-with-git

- https://stackoverflow.com/questions/4470523/create-a-branch-in-git-from-another-branch

# Changelog
- 2019-11-30 init
