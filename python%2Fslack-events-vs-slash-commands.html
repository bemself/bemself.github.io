<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.22" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>python/slack-events-vs-slash-commands: My Struggle — Life goes on...</title>
</head>
<body class="tc-body">

<section class="tc-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists " data-tags="" data-tiddler-title="python/slack-events-vs-slash-commands"><div class="tc-tiddler-title"><div class="tc-titlebar"><span class="tc-tiddler-controls"><span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span></span><span><span class="tc-tiddler-title-icon" style="fill:;"></span><h2 class="tc-title">python/slack-events-vs-slash-commands</h2></span></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal"><div class="tc-subtitle"><a class="tc-tiddlylink tc-tiddlylink-missing" href=".html"></a>26th July 2020</div></div><div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>

<div class="tc-tiddler-body tc-reveal"><hr><p>title:  Slack 交互- bot, slash command, events, RTM 之简单区别<br>date:  2020-05-04 11:00:55<br>edit:  2020-05-04 11:00:59<br>layout: post<br>status: Writing<br>categories:</p><ul><li><p>Python<br>tags:</p></li><li><p>Python<br>description:  slack 这几种交互方式有啥区别, bot 又是啥</p></li></ul><hr><h1>背景</h1><p>想研究下怎么通过 slack 发送指令给第三方应用程序, 以及接收第三方程序的反馈.  从 slash command 开始看, 结果到 events 和 RTM 转了一圈, 又回到 slash commands, 发现这个才是最实惠简单符合需求的.</p><p>所以就简单记录一下我认为的三者的区别</p><h1>必备</h1><p>进行交互前, 得先理解:</p><ul><li><p><a href="https://api.slack.com/start/overview" target="_blank">Slack apps</a></p></li><li><p><a href="https://api.slack.com/web" target="_blank">Using the Slack Web API</a></p></li><li><p><a href="https://api.slack.com/bot-users#bots-overview" target="_blank">Bots</a></p></li></ul><p>简单两句话:</p><ul><li><p>slack app 是扩展了 slack 本身, 除了常规手动能做的操作外, 通过 api 强化了自动化操作.</p></li><li><p>bots 也是一类 slack app, 只不过是&quot;虚拟的&quot;你可以与之对话的&quot;人&quot;, 通过 bot user 来实现实时对话.</p></li></ul><p>这些自动化操作, 除了 slack 本身提供的之外, 便是第三方应用程序可与之交互实现的.</p><h1>简述</h1><p>slack 与第三方应用程序交互, 目前看起来有三种交互方式:</p><h2><a href="https://api.slack.com/events-api#subscriptions" target="_blank">Event Subscriptions</a></h2><p>理念是 <code>Don't call us, we'll call you</code>:</p><pre>- 3rd server 订阅了 slack 的某个类型的 event, 比如 react_added 了表情之类
- 当用户在 slack 端触发了这个 event 时,
- slack 发送请求到 3rd server, 带着包含这个 event 信息的 json payload
- 3rd server 接受请求, 并针对这个 event 处理内部业务逻辑
</pre><p>这里的 3rd server 就静静的等着 slack 推送就好. 当然如果想主动去交互也 ok, 但这个不是设计应用重点.</p><blockquote><p>Before you can use the <a href="https://api.slack.com/events-api" target="_blank">Events API</a> you must <a href="https://api.slack.com/apps/new" target="_blank">create a Slack App</a>, and turn on <a href="https://api.slack.com/events-api#subscriptions" target="_blank">Event Subscriptions</a>.</p></blockquote><p>如果想用 python 开发, 可以试试<br><a href="https://github.com/slackapi/python-slack-events-api" target="_blank">slackapi/python-slack-events-api: Slack Events API adapter for Python</a></p><p>示例: <a href="https://github.com/slackapi/python-slack-events-api/tree/master/example" target="_blank">python-slack-events-api/example</a></p><p>虽然这个 events 很好用,</p><blockquote><p>Slack events are delivered to a secure webhook, and allows you to connect to slack without the RTM websocket connection.</p></blockquote><p>但是实际环境中, 有些 3rd server 在防火墙后面, 可能不能主动收到 slack 的 events 请求. 这时候可以用 RTM client.</p><h2><a href="https://api.slack.com/rtm" target="_blank">Real Time Messaging API</a></h2><p>这个是可以实时监听 slack 的 events, 即 app server 得建立个连接, 放在那儿监听 slack 的信息. 不同于 events api 的那种 PUSH 模式 &quot;slack 有了消息就 call 你&quot;, 而是 PULL 模式 &quot;你去看看 slack 有消息了没&quot;.<br><a href="https://github.com/slackapi/python-slackclient" target="_blank">slackapi/python-slackclient: Slack Python SDK https://slack.dev/python-slackclient/</a></p><p>支持异步通信. 不过新的 slack app 已不太用这种方式了</p><blockquote><p>New Slack apps may not use any Real Time Messaging API method. Create a classic app and use the V1 Oauth flow to use RTM.</p></blockquote><h2><a href="https://api.slack.com/slash-commands" target="_blank">Slash Commands</a></h2><blockquote><p>Slash commands are special commands triggered by typing a &quot;/&quot; then a command.</p></blockquote><p>这个交互最简单直接, 在 slack channel 对话框中输入 &quot;/<slash command="true"> <your +="true" app="true" args="true" command="true" customized="true">, 比如输入 /say hello <name>, 你的 app server 会收到一个请求, payload 中有 text=&quot;hello <name>&quot; , 你的 app 程序便可以解析并执行对应的业务逻辑, 然后返回结果给 slack.</name></name></your></slash></p><p>实现上也很简单, 搭建个 flask api server, 处理一下 slack 请求就好. 不需要应对各种不同的 events (相对前面几类交互而言)</p><h1>Reference</h1><ul><li><p><a href="https://api.slack.com/events-api" target="_blank">Events API</a></p></li><li><p><a href="https://renzo.lucioni.xyz/serverless-slash-commands-with-python/" target="_blank">Serverless Slash Commands with Python - Renzo Lucioni</a></p></li><li><p><a href="https://github.com/slackapi/python-slackclient" target="_blank">slackapi/python-slackclient: Slack Python SDK https://slack.dev/python-slackclient/</a></p></li><li><p><a href="https://botkit.ai/docs/v0/readme-slack.html" target="_blank">Botkit and Slack - Botkit Documentation</a></p></li></ul><h1><a class="tc-tiddlylink tc-tiddlylink-missing" href="ChangeLog.html">ChangeLog</a></h1><ul><li><p>2020-05-04 init</p></li></ul></div>



</div>

</p>
</section>
</body>
</html>
