<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.22" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>python/Pyenv-Virtualenv-setup: My Struggle — Life goes on...</title>
</head>
<body class="tc-body">

<section class="tc-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists " data-tags="" data-tiddler-title="python/Pyenv-Virtualenv-setup"><div class="tc-tiddler-title"><div class="tc-titlebar"><span class="tc-tiddler-controls"><span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span></span><span><span class="tc-tiddler-title-icon" style="fill:;"></span><h2 class="tc-title">python/Pyenv-Virtualenv-setup</h2></span></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal"><div class="tc-subtitle"><a class="tc-tiddlylink tc-tiddlylink-missing" href=".html"></a>26th July 2020</div></div><div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>

<div class="tc-tiddler-body tc-reveal"><hr><p>title: Python - pyenv virtualenv setup<br>date: 2019-04-11<br>edit: 2019-04-11<br>status:  Completed<br>layout: post<br>categories:</p><ul><li><p>Python<br>tags:</p></li><li><p>Python<br>description: Python 2 和 3 如何和平共处在同一台电脑中？同一版本的 Python 如何安装不同版本的模块等等，pyenv virtualenv来帮忙</p></li></ul><hr><h1>配置pyenv virtualenv 环境</h1><p>本文节选自大妈的蟒营课程笔记。</p><p>安装python模块时出错，经查，现有环境是py3, 而所安装的模块用的execfile是python2的，在python3中变成了exec(), 所以需要安装Python2的环境。其实大妈任务中已指明2.7.15, 我自作主张以为py3应该可以用没问题。。。</p><p>由于电脑中已有py2和py3，已混乱，很早被提醒pyenv很好用，一直拒绝开始。</p><h2>关于 pyenv, virtualenv, pyenv-virtualenv</h2><p>先理一下三者的关系，异同。</p><p><strong>pyenv</strong>是管理环境中的<strong>Python版本</strong>的，比如可以有Python 2.7.10, Python 2.7.15, Python 3.6等。</p><p><strong>virtualenv</strong>是管理某个具体Python版本的<strong>Packages</strong>(包)的，比如可以有：</p><p><code>pyenv 2.7.10 virtualenv1</code>, <code>pyenv 2.7.10 virtualenv2</code></p><ul><li><p>virtualenv1中：基于python2.7.10的django app需要用到django 1.6</p></li><li><p>virtualenv2中：基于Python2.7.10的django app需要用到django 2.6</p></li></ul><p>以此来隔离app开发环境。</p><p>virtualenv的创建，其实是将系统当前Python版本的解析器等复制了一份到本地app 文件夹中，再加载app所需的各种包。这样便和系统Python环境隔离开了。</p><p>但是这样有一个不足之处，如果开发其他的app也要用到类似的环境，就需要在新的app folder里面重新创建一个virtualenv，再同样加载所需的包。这样就达不到类似编程中的<strong>复用（Reuse）</strong>效果。</p><p>所以又有了Pyenv-virtualenv, 直接在系统环境下创建某个Python版本的多个virtual环境，各赋予一个名字。当开发各种app时:</p><ul><li><p>如有直接可用的virtual环境，直接调用之。</p></li><li><p>如无现有可用的，pyenv-virtualenv 新创建一个，然后调用之。</p></li></ul><h2>使用pyenv搭建python2.7.15</h2><p>官方github：<a href="https://github.com/pyenv/pyenv#homebrew-on-macos" target="_blank">pyenv/pyenv: Simple Python version management</a></p><p>pyenv全部可用命令：<a href="https://github.com/pyenv/pyenv/blob/master/COMMANDS.md" target="_blank">pyenv/COMMANDS.md at master · pyenv/pyenv</a></p><p>安装pyenv：（Mac）</p><pre><code>brew install pyenv
</code></pre><p>查看所有pyenv命令：</p><pre><code>pyenv commands
</code></pre><p>查看python 2.7.15是否可安装</p><pre><code>pyenv install --list
</code></pre><p>pyenv versions 查看，2.7.15在列，OK</p><pre><code>* system (set by /Users/test/.pyenv/version)
  2.7.15
</code></pre><p>方便起见，先将py2.7.15设为全局环境</p><pre><code>pyenv global 2.7.15
</code></pre><p>pyenv version：显示目前环境中的确实是2.7.15</p><pre><code>2.7.15 (set by /Users/test/.pyenv/version)
</code></pre><p>以后如需要，再单独设local环境，如：</p><pre><code>pyenv local 3.6
</code></pre><p>至此以为一切OK了，但是在命令行里跑<code>python</code>,显示的却是系统自带的2.7.10，咋回事？</p><pre><code>Python 2.7.10 (default, Aug 17 2018, 17:41:52) 
</code></pre><p>尝试下pyenv local，依然如此，不得其解ing。。。待尝试<a href="https://github.com/pyenv/pyenv-virtualenv" target="_blank">pyenv/pyenv-virtualenv: a pyenv plugin to manage virtualenv (a.k.a. python-virtualenv)</a>.【解决方案见下文】</p><h2>安装pyenv-virtualenv</h2><p><a href="https://github.com/pyenv/pyenv-virtualenv" target="_blank">pyenv/pyenv-virtualenv: a pyenv plugin to manage virtualenv (a.k.a. python-virtualenv)</a></p><p>为啥有了pyenv, virtualenv, 又出来个结合版？</p><blockquote><p>The main difference is that :</p><ul><li><p>pyenv : copies an entire Python installation every time<br>you create a new pyenv version.</p></li><li><p>In contrast, virtualenv makes use of<br>symbolic links to decrease the size of the virtualenv’s.</p></li><li><p><code>pyenv-virtualenv</code>: adds complete virtualenv functionality to pyenv:</p></li></ul><p>—— <a href="https://amaral.northwestern.edu/resources/guides/pyenv-tutorial" target="_blank">pyenv Tutorial - Guides - Resources - Amaral Lab</a></p></blockquote><p>安装pyenv-virtualenv on Mac</p><pre><code>brew install pyenv-virtualenv
</code></pre><p>使用：</p><p>准备建一个专门用于camp的2.7.15环境，运行：</p><pre><code>pyenv virtuanenv 2.7.15 camp
</code></pre><p>看看装完什么情况：</p><pre><code>pyenv versions
</code></pre><pre><code>pyenv: version `2.7.15/envs/camp_orphan' is not installed (set by /Users/gitlab.com.camp/orphan/.python-version)
  system
  camp
  2.7.15
  2.7.15/envs/camp
</code></pre><h2>坑们</h2><ul><li><p>Mac上安装 <code>python 2.7.15</code> 失败报错:</p></li></ul><pre><code>ERROR: The Python zlib extension was not compiled. Missing the zlib?
</code></pre><p>通过Stack Overflow 找到官方wiki <a href="https://github.com/pyenv/pyenv/wiki/Common-build-problems" target="_blank">Common build problems · pyenv/pyenv Wiki</a></p><p>解决：</p><pre><code>brew install zlib
</code></pre><p>Not working. 再试，因为我的mac是 Mojave or higher (10.14+)</p><blockquote><p>you will also <a href="https://developer.apple.com/documentation/xcode_release_notes/xcode_10_release_notes#3035624" target="_blank">need to install the additional SDK headers</a></p></blockquote><pre><code>sudo installer -pkg /Library/Developer/CommandLineTools/Packages/macOS_SDK_headers_for_macOS_10.14.pkg -target /
</code></pre><p>再重新安装2.7.15 成功。</p><ul><li><p>pyenv 环境中运行 python 显示的是系统python版本</p></li></ul><p>运行：<code>pyenv global 2.7.15</code>后，<code>pyenv version</code>显示正常为2.7.15, 但是再运行 <code>python</code>却显示为系统本地的python 2.7.10：</p><pre><code>Python 2.7.10 (default, Aug 17 2018, 17:41:52) 
</code></pre><p>尝试下pyenv local，依然如此，不得其解ing。。。</p><p><strong>问题解决</strong>：</p><p>在~/.bash_profile中添加一下几行，并保存</p><pre><code>export PATH=&quot;~/.pyenv/bin:$PATH&quot;    
eval &quot;$(pyenv init -)&quot;    
eval &quot;$(pyenv virtualenv-init -)&quot;  
</code></pre><p>运行python，依然是2.7.10，而不是2.7.15。而且我的folder前面依然是光秃秃的，没有出现类似(2.7.15)这种虚拟环境的标识。</p><p>想着是不是virtualenv没有成功activate呢？试着手动去activate：</p><pre><code>pyenv activate 2.7.15/envs/camp
</code></pre><p>哈，报错了</p><pre><code>Failed to activate virtualenv.

Perhaps pyenv-virtualenv has not been loaded into your shell properly.
Please restart current shell and try again.
</code></pre><p>再运行</p><pre><code>pyenv shell 2.7.15/envs/camp
</code></pre><p>有点线索了，结果提示：</p><pre><code>pyenv: shell integration not enabled. Run `pyenv init' for instructions.
</code></pre><p>运行 <code>pyenv init</code>后，有眉目了：</p><pre><code># Load pyenv automatically by appending
# the following to ~/.bash_profile:

eval &quot;$(pyenv init -)&quot;
</code></pre><p>原来是，我虽然在~/.bash_profile文件中加入了这一行，但这个并未生效，我还需要运行</p><pre><code>source ~/.bash_profile
</code></pre><p>现在，看到了virtual环境的标识了，自动activate成功：</p><pre><code>(2.7.15/envs/camp) 
</code></pre><p>现在再运行python, 便是2.7.15了。</p><h2>待解问题（已解决）</h2><p><code>pyenv install 3.7.0</code>后，切换到 <code>pyenv local 3.7.0</code>, 运行 python, 显示仍然是 2.7...</p><h3>找原因：</h3><p>刚终于认真去看了<a href="https://github.com/pyenv/pyenv#how-it-works" target="_blank">pyenv/pyenv: Simple Python version management</a>官方文档，其中提到了一点：</p><blockquote><p>Directories in PATH are searched <strong>from left to right</strong>, so a matching executable in a directory at the beginning of the list takes precedence over another one at the end</p></blockquote><p>我查看了下我的 PATH，最左面竟然是 /usr/local/bin: /usr/bin，系统自带的python都在这里面了。</p><h3>解决：</h3><p>所以我的解决方案：删了这俩（因为后面还有这俩）。现在OK了。</p><p>现在再理解一下 pyenv 运行命令的顺序：PATH 是第一位的。</p><blockquote><p>So with pyenv installed, when you run, say, pip, your operating system will do the following:<br>Search your <strong>PATH</strong> for an executable file named pip<br>Find the <strong>pyenv shim</strong> named pip at the beginning of your PATH<br>Run the shim named pip, which in turn passes the command along to pyenv</p></blockquote><h2>参考:</h2><ul><li><p><a href="https://github.com/pyenv/pyenv#how-it-works" target="_blank">pyenv/pyenv: Simple Python version management</a></p></li><li><p><a href="http://yixuan.li/geek/2018/07/31/pyenvVirtualenv/" target="_blank">怎么才能放飞自我的玩儿Python · Yixuan</a></p></li><li><p><a href="https://mp.weixin.qq.com/s/42vxWCUJ5E9hiOzYHPNzdQ" target="_blank">pyenv 终极指南</a></p></li></ul></div>



</div>

</p>
</section>
</body>
</html>
