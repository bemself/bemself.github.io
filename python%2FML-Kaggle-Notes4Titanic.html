<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.22" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>python/ML-Kaggle-Notes4Titanic: My Struggle — Life goes on...</title>
</head>
<body class="tc-body">

<section class="tc-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists " data-tags="" data-tiddler-title="python/ML-Kaggle-Notes4Titanic"><div class="tc-tiddler-title"><div class="tc-titlebar"><span class="tc-tiddler-controls"><span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span></span><span><span class="tc-tiddler-title-icon" style="fill:;"></span><h2 class="tc-title">python/ML-Kaggle-Notes4Titanic</h2></span></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal"><div class="tc-subtitle"><a class="tc-tiddlylink tc-tiddlylink-missing" href=".html"></a>26th July 2020</div></div><div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>

<div class="tc-tiddler-body tc-reveal"><hr><p>title: 我的第一个 Kaggle 比赛学习 - Titanic<br>date: 2020-01-25<br>edit: 2020-01-25<br>layout: post<br>status: Completed<br>categories:</p><ul><li><p>Python, ML,Kaggle<br>tags:</p></li><li><p>Python, ML,Kaggle<br>description:  熟悉 Random Forest 算法，初识 ensemble learning</p></li></ul><hr><h1>背景</h1><p><a href="https://www.kaggle.com/c/titanic" target="_blank">Titanic: Machine Learning from Disaster - Kaggle</a></p><p>2 年前就被推荐照着这个比赛做一下，结果我打开这个页面便蒙了，完全不知道该如何下手。</p><p>两年后，再次打开这个页面，看到清清楚楚的<a href="https://www.kaggle.com/alexisbcook/titanic-tutorial" target="_blank">Titanic Tutorial - Kaggle</a>，完全傻瓜式的照着做就能做下来。当年是什么蒙蔽了我的眼睛~</p><h2>Target</h2><p>use machine learning to create a model that predicts which passengers survived the Titanic shipwreck</p><h2>Data</h2><p><a href="https://www.kaggle.com/c/titanic/data" target="_blank">Titanic: Machine Learning from Disaster - Kaggle</a></p><ul><li><p>train.csv</p><ul><li><p>Survived: 1=yes, 0=No</p></li></ul></li><li><p>test.csv</p></li><li><p>gender_submission.csv: for prediction</p><ul><li><p><a class="tc-tiddlylink tc-tiddlylink-missing" href="PassengerId.html">PassengerId</a>: those from test.csv</p></li><li><p>Survived: final result</p></li></ul></li></ul><h2>Guide to help start and follow</h2><p><a href="https://www.kaggle.com/alexisbcook/titanic-tutorial" target="_blank">Titanic Tutorial - Kaggle</a></p><ul><li><p><a href="https://www.kaggle.com/account/login?returnUrl=%2Fc%2Ftitanic" target="_blank">Join the Competition Here!</a></p></li><li><p><a href="https://www.kaggle.com/c/titanic/submit" target="_blank">Submit a initial result</a>:</p></li><li><p><a href="https://www.kaggle.com/c/titanic/notebooks" target="_blank"><a class="tc-tiddlylink tc-tiddlylink-missing" href="NoteBook.html">NoteBook</a></a></p></li></ul><h2>Learning Model</h2><p>摘抄的网站的解释，后面具体谈。</p><ul><li><p>random forest model</p><ul><li><p>constructed of several &quot;trees&quot;</p><ul><li><p>that will individually consider each passenger's data</p></li><li><p>and vote on whether the individual survived.</p></li><li><p>Then, the random forest model makes a democratic decision:</p><ul><li><p>the outcome with the most votes wins!</p></li></ul></li></ul></li></ul></li></ul><h2><a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html" target="_blank">sklearn.ensemble.<a class="tc-tiddlylink tc-tiddlylink-missing" href="RandomForestClassifier.html">RandomForestClassifier</a></a></h2><p>Titanic比赛中用到的是 <code>RandomForestClassifier</code> 算法，在了解这个算法前，我注意到 <code>sklearn</code> 中这个算法类是在 <code>ensemble</code> 模块中，英文不好，不知道 <code>ensemble</code> 是什么意思？所以想先了解一下 <code>ensemble</code></p><h3>ensemble</h3><p>字典的解释是：<code>a number of things considered as a group</code></p><p>听起来有组合的意思。</p><p>搜索了一下，在 ML 中有 <code>ensemble learning</code>, 翻译多是“集成学习”，参考<a href="https://www.zhihu.com/question/29036379" target="_blank">集成学习（ensemble learning）应如何入门？ - 知乎</a>提到，有三种常见的集成学习框架：<code>bagging</code>，<code>boosting</code> 和 <code>stacking</code>。</p><p>从 <a href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.ensemble" target="_blank">API Reference — scikit-learn 0.22.1 documentation</a>中也能看出来这几种框架都有相应的算法。</p><p><code>Random Forest</code> 是 <code>bagging</code> 框架中的一个算法。这里就单先试着理解这个，其他框架等以后遇到了再说。但是了解这个之前，还是得先清楚 <a href="https://en.wikipedia.org/wiki/Ensemble_learning" target="_blank">Ensemble Learning</a> 到底是什么？</p><blockquote><p>In statistics and machine learning, ensemble methods use multiple learning algorithms to obtain better predictive performance than could be obtained from any of the constituent learning algorithms alone.</p></blockquote><p>这个解释应和了字面上的意思，组合了多种算法来获得更好的预测性能，结果优于单用其中的单个算法。</p><h3>bagging 框架</h3><p><a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.BaggingClassifier.html" target="_blank">sklearn.ensemble.<a class="tc-tiddlylink tc-tiddlylink-missing" href="BaggingClassifier.html">BaggingClassifier</a> — scikit-learn 0.22.1 documentation</a></p><blockquote><p>A Bagging classifier is an ensemble meta-estimator that fits base classifiers each on random subsets of the original dataset and then aggregate their individual predictions (either by voting or by averaging) to form a final prediction.</p></blockquote><p>大意就是：</p><ul><li><p>从源数据集中随机抽样一部分子集样本</p></li><li><p>在这个子集样本上训练分类器</p></li><li><p>重复多次上述步骤</p></li><li><p>然后将各分类器的预测结果整合 （求平均或投票）</p></li><li><p>形成最终的预测</p></li></ul><p>问题是：</p><ul><li><p>抽取多少次子集样本，即要做多少分类器？</p></li><li><p>随机抽取的算法用什么？</p></li><li><p>整合各分类器结果的时候，求平均和投票各有什么优劣势？</p></li><li><p>如何训练各个分类器？</p></li></ul><p>我都不晓得~</p><p>前面提到 <code>Random Forest</code> 是 <code>bagging</code> 框架的一种算法。现在来看看这个算法如何解答我的一些疑问。</p><h3>Random Forest 算法</h3><p><a href="https://scikit-learn.org/stable/modules/ensemble.html#forest" target="_blank">1.11. Ensemble methods — scikit-learn 0.22.1 documentation</a></p><blockquote><p>The prediction of the ensemble is given as the averaged prediction of the individual classifiers.</p></blockquote><p>先明确了一个，这个算法是怼各分类器求平均的。Forest of what? 自然是 forest of trees, 而这里的 tree 指的是 <strong><a href="https://scikit-learn.org/stable/modules/tree.html#tree" target="_blank">decision trees</a></strong>，所以这个算法其实是 <strong><code>averaging algorithms based on randomized decision trees</code></strong></p><blockquote><p>random forest builds multiple decision trees and merges them together to get a more accurate and stable prediction.</p></blockquote><p><code>Random forest</code>对每个分类器都建一个决策树，然后再合并。</p><p>分类器是如何划分的呢？还是以 Titanic 的代码为例来试着理解下：</p><pre><code>from sklearn.ensemble import RandomForestClassifier

y = train_data[&quot;Survived&quot;]

features = [&quot;Pclass&quot;, &quot;Sex&quot;, &quot;SibSp&quot;, &quot;Parch&quot;]
X = pd.get_dummies(train_data[features])
model = RandomForestClassifier(n_estimators=100, max_depth=5, random_state=1)
model.fit(X, y)
</code></pre><ul><li><p><code>y</code>：是训练集中灾难中存活的人的集合</p></li><li><p><code>features</code>: 是这些人的特征值，如性别，几等舱等</p></li><li><p>X ：生成 dummy 数据，为什么要用 <code>get_dummies</code>而不是直接用<code>train_data[features]</code>呢？</p></li></ul><p>尝试直接用 <code>train_data[features]</code>, 打印 X 的结果是这样的：</p><pre><code>     Pclass     Sex  SibSp  Parch
0         3    male      1      0
1         1  female      1      0
</code></pre><p>如果再继续用这个 X 建模的话，会报错：</p><pre><code>ValueError: could not convert string to float: 'male'
</code></pre><p>显然，因为 Sex 字段是 string 类型，而模型需要的是 float 类型，所以不能直接用  <code>train_data[features]</code></p><p>那 <code>get_dummies()</code> 的作用也清楚了，就是将这些 string 类型的字段转化成 float 类型。从下面的打印结果也可以看出，Sex 字段被分成了两个字段，Sex_male, Sex_female, 其值分别是 0 和 1.</p><pre><code>Pclass  SibSp  Parch  Sex_female  Sex_male
0         3      1      0           0         1
1         1      1      0           1         0
2         3      0      0           1         0
3         1      1      0           1         0
4         3      0      0           0         1
..      ...    ...    ...         ...       ...
886       2      0      0           0         1
887       1      0      0           1         0
888       3      1      2           1         0
889       1      0      0           0         1
890       3      0      0           0         1
</code></pre><ul><li><p><code>RandomForestClassifier(n_estimators=100, max_depth=5, random_state=1)</code></p><ul><li><p>这几个参数分别是什么意思？</p><ul><li><p>n_estimators ： 决策树的数量</p></li><li><p>max_depths：决策树的最大深度</p></li><li><p><a href="https://scikit-learn.org/stable/glossary.html#term-random-state" target="_blank">random_state</a>: 控制随机数生成器的，（实际没太明白，这个随机是不是指随机抽样？），可能要和其他参数配合用比如 shuffle。另外还提到，这个数用了控制随机算法，使得运行多次每次都还是产生相同结果？</p><ul><li><p>To make a randomized algorithm deterministic (i.e. running it multiple times will produce the same result), an arbitrary integer random_state can be used</p></li></ul></li></ul></li></ul></li></ul><p>具体如何调参，参考 <a href="https://scikit-learn.org/stable/modules/ensemble.html#random-forest-parameters" target="_blank">parameter tuning guidelines</a></p><h2><code>Random Forest</code>的应用场景</h2><p>既然是分类器算法，自然很多分类应用的场景都适合了；另外还有回归问题的场景。</p><p>这篇文章<a href="https://builtin.com/data-science/random-forest-algorithm" target="_blank">The Random Forest Algorithm: A Complete Guide - Built In</a>给出了一个实际例子的类比：</p><ul><li><p>你在决定去哪儿旅行，去询问你的朋友</p></li><li><p>朋友问，你以前的旅行中喜欢和不喜欢的方面都哪些</p><ul><li><p>在这个基础上给出了一些建议</p></li></ul></li><li><p>这为你的决策提供了素材</p></li><li><p>同样的步骤，你又去询问另一个朋友</p></li><li><p>以及另另一个朋友</p></li><li><p>...</p></li></ul><p>同样，你拿到了几个 offer，犹豫该接哪个等等；看中了几套房子，决定选哪个，貌似都可以套用这个算法一试了。</p><h2>学到的几个之前不熟悉的代码</h2><ul><li><p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.head.html" target="_blank">pandas.<a class="tc-tiddlylink tc-tiddlylink-missing" href="DataFrame.html">DataFrame</a>.head</a>：返回数据集中的头几行数据，参数为 n，默认 n=5</p></li></ul><pre><code>test_data = pd.read_csv(&quot;/kaggle/input/titanic/test.csv&quot;)
test_data.head()
</code></pre><ul><li><p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.loc.html" target="_blank">pandas.<a class="tc-tiddlylink tc-tiddlylink-missing" href="DataFrame.html">DataFrame</a>.loc</a></p></li></ul><pre><code>men = train_data.loc[train_data.Sex == 'male'][&quot;Survived&quot;]
rate_men = sum(men)/len(men)
</code></pre><h2>Reference</h2><ul><li><p><a href="https://www.zhihu.com/question/29036379" target="_blank">集成学习（ensemble learning）应如何入门？ - 知乎</a></p></li><li><p><a href="https://link.zhihu.com/?target=http%3A//cs.nju.edu.cn/zhouzh/zhouzh.files/publication/springerEBR09.pdf" target="_blank">Ensemble Learning》</a></p></li><li><p><a href="https://builtin.com/data-science/random-forest-algorithm" target="_blank">The Random Forest Algorithm: A Complete Guide - Built In</a></p></li></ul><h2><a class="tc-tiddlylink tc-tiddlylink-missing" href="ChangeLog.html">ChangeLog</a></h2><ul><li><p>2020-01-22 init</p></li></ul></div>



</div>

</p>
</section>
</body>
</html>
