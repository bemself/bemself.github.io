<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.22" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>jenkins/Pass-Parameter-within-build-using-groovy: My Struggle — Life goes on...</title>
</head>
<body class="tc-body">

<section class="tc-story-river">
<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists " data-tags="" data-tiddler-title="jenkins/Pass-Parameter-within-build-using-groovy"><div class="tc-tiddler-title"><div class="tc-titlebar"><span class="tc-tiddler-controls"><span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span></span><span><span class="tc-tiddler-title-icon" style="fill:;"></span><h2 class="tc-title">jenkins/Pass-Parameter-within-build-using-groovy</h2></span></div><div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div></div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal"><div class="tc-subtitle"><a class="tc-tiddlylink tc-tiddlylink-missing" href=".html"></a>26th July 2020</div></div><div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>

<div class="tc-tiddler-body tc-reveal"><hr><p>title: Jenkins - Pass Parameters within Build using Groovy<br>edit: 2018-08-10<br>layout: post<br>categories:</p><ul><li><p>Python<br>tags:</p></li><li><p>Python<br>description: Jenkins持续集成。After Jenkins is upgraded from 1.0 to 2.0, our existing solution for creating and passing build parameters stops to workings.</p></li></ul><hr><h1>Background</h1><p>We have a job which has two build steps:</p><ul><li><p>a groovy step to generate runtime build parameters, which will be used for following steps</p></li><li><p>a windows batch build step to consume the runtime build parameters generated by the groovy step</p></li></ul><p>This works well in Jenkins 1.0, but after migrated to Jenkins 2.0, it retired.</p><h2>Analysis</h2><p>After a google search, it turned out that Jenkins 2.0 has injected <a href="jenkins.io/security/advisory/2016-05-11/" target="_blank">a new security advisory</a>, where previous allowed arbitrary parameters are accepted as environment variables, but that is not safe. Now Jenkins forces to use build parameters. But there are always exceptions, for known safe parameters are still allowed in below way:</p><pre><code>java -Dhudson.model.ParametersAction.safeParameters=FOO,BAR_BAZ,qux -jar jenkins.war
</code></pre><p>correspondingly if user is using groovy script to add new <a class="tc-tiddlylink tc-tiddlylink-missing" href="ParamtersAction.html">ParamtersAction</a>, there is also a <a href="https://github.com/jenkinsci/jenkins/blob/master/core/src/main/java/hudson/model/ParametersAction.java" target="_blank">corresponding constructor</a> to use.</p><h2>Solution</h2><p>So in Jenkins 1.0, we have:</p><pre><code>import hudson.model.*
  
def build = Thread.currentThread()?.executable
def param = new ParametersAction([new StringParameterValue(&quot;NEW_PARAM&quot;,lang)])
build.addAction(param)
return param

</code></pre><p>Now in Jenkins 2.0:</p><pre><code>import hudson.model.*
  
def build = Thread.currentThread()?.executable
def param = new ParametersAction([new StringParameterValue(&quot;NEW_PARAM&quot;,lang)], [&quot;NEW_PARAM&quot;])
build.addAction(param)
return param
</code></pre><p>very small change huh, but it avoids redesign the jobs.</p><p>To use this new-added parameter, in later build steps e.g. windows batch command step:</p><pre><code>echo %NEW_PARAM%
</code></pre><h2>Reference</h2><p>https://stackoverflow.com/questions/10413936/creating-a-jenkins-environment-variable-using-groovy</p><p>https://itisatechiesworld.wordpress.com/jenkins-related-articles/jenkins-configuration/jenkins-environment-variables/</p></div>



</div>

</p>
</section>
</body>
</html>
